# ğŸ“¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ & è‡ªå·±ç´¹ä»‹æ©Ÿèƒ½ å®Ÿè£…å®Œäº†! âœ…

ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨è‡ªå·±ç´¹ä»‹ã®ç·¨é›†æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸ!

---

## ğŸ“‹ **å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½**

### 1ï¸âƒ£ **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
- âœ… `input type="file"`ã§ç”»åƒé¸æŠ
- âœ… é¸æŠå³åº§ã«**ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º**
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼åˆ¶é™: **JPG, PNG, WEBP**
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™: **æœ€å¤§2MB**
- âœ… ç”»åƒå‰Šé™¤ãƒœã‚¿ãƒ³ (X ã‚¢ã‚¤ã‚³ãƒ³)

### 2ï¸âƒ£ **è‡ªå·±ç´¹ä»‹ (Bio)**
- âœ… ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã§æœ€å¤§**200æ–‡å­—**
- âœ… æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤º
- âœ… ç©ºç™½è¨±å¯ (ä»»æ„å…¥åŠ›)

### 3ï¸âƒ£ **ãƒã‚¤ãƒšãƒ¼ã‚¸çµ±åˆ**
- âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒè¡¨ç¤º
- âœ… è‡ªå·±ç´¹ä»‹è¡¨ç¤º (2è¡Œã¾ã§)
- âœ… ç”»åƒãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ 

### 4ï¸âƒ£ **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° & ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
- âœ… è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã®é‡è¤‡é€ä¿¡é˜²æ­¢

---

## ğŸš€ **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨å®Ÿè¡Œæ–¹æ³•**

### **Step 1: Supabase ã‚¹ã‚­ãƒ¼ãƒå®Ÿè¡Œ**

1. **Supabase Dashboard** ã«ã‚¢ã‚¯ã‚»ã‚¹
   ```
   https://supabase.com/dashboard â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ
   ```

2. **SQL Editor** ã‚’é–‹ã
   - å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ **"SQL Editor"** ã‚¯ãƒªãƒƒã‚¯

3. **New query** ã‚¯ãƒªãƒƒã‚¯

4. **ã‚¹ã‚­ãƒ¼ãƒã‚’ã‚³ãƒ”ãƒ¼ & å®Ÿè¡Œ**
   - `supabase_profiles.sql` ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’**å…¨ä½“ã‚³ãƒ”ãƒ¼**
   - SQL Editorã«è²¼ã‚Šä»˜ã‘
   - **"Run"** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ âœ…

5. **ç¢ºèª**
   - ã‚¨ãƒ©ãƒ¼ãªãå®Œäº†ã—ãŸã‚‰æˆåŠŸ!
   - ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª:
     - `profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `avatar_url`, `bio` ã‚«ãƒ©ãƒ è¿½åŠ 
     - Storage ã« `avatars` ãƒã‚±ãƒƒãƒˆä½œæˆ

---

### **Step 2: Storage ãƒã‚±ãƒƒãƒˆä½œæˆ (æ‰‹å‹•æ¨å¥¨)**

1. **Supabase Dashboard** â†’ **Storage**
2. **"Create bucket"** ã‚¯ãƒªãƒƒã‚¯
3. è¨­å®š:
   - **Bucket name**: `avatars`
   - **Public bucket**: âœ… **ãƒã‚§ãƒƒã‚¯å¿…é ˆ!**
   - **File size limit**: 2MB
   - **Allowed MIME types**: `image/jpeg, image/png, image/webp`
4. **"Create"** ã‚¯ãƒªãƒƒã‚¯

---

### **Step 3: ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•**

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œ:

```bash
# Node ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
pkill -9 node

# ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤
rm -rf .next

# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
npm run dev
```

---

### **Step 4: ãƒ†ã‚¹ãƒˆ**

1. **ãƒã‚¤ãƒšãƒ¼ã‚¸** (`/mypage`) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **è¨­å®šã‚¢ã‚¤ã‚³ãƒ³** (âš™ï¸) ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†"** ã‚’é¸æŠ
4. **ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒé¸æŠ
5. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç¢ºèª
6. è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›
7. **"ä¿å­˜"** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
8. ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Šã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã¨è‡ªå·±ç´¹ä»‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ“ **ç”Ÿæˆ/æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**

### **æ–°è¦ä½œæˆ**
1. `supabase_profiles.sql`
   - profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒ
   - avatars ãƒã‚±ãƒƒãƒˆè¨­å®š
   - RLS ãƒãƒªã‚·ãƒ¼

2. `src/lib/avatarUpload.ts`
   - ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   - `uploadAvatar()`: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - `deleteAvatar()`: ç”»åƒå‰Šé™¤
   - `validateAvatarFile()`: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - `getAvatarPreviewUrl()`: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ

3. `src/features/user/hooks/useProfile.ts`
   - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç† Hook
   - `fetchProfile()`: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
   - `updateProfile()`: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°

### **æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**
1. `src/app/settings/profile/page.tsx`
   - ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UI
   - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
   - ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ

2. `src/app/mypage/page.tsx`
   - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒè¡¨ç¤º
   - è‡ªå·±ç´¹ä»‹è¡¨ç¤º
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒã‚¿ãƒ¼å‡¦ç†

---

## ğŸ¨ **UI/UX**

### **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ç”»é¢**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚        â”‚         â”‚  X              â”‚ â† å‰Šé™¤ãƒœã‚¿ãƒ³
â”‚        â”‚  ç”»åƒ   â”‚                 â”‚
â”‚        â”‚         â”‚  ğŸ“·             â”‚ â† ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚   JPGã€PNGã€WEBPå½¢å¼ã€æœ€å¤§2MB      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŒ¿åå¤ªéƒ                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  5/20                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªå·±ç´¹ä»‹ï¼ˆä»»æ„ï¼‰                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›...           â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  0/200                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ ã‚­ãƒ£ãƒ³ã‚»ãƒ« ]  [ ä¿å­˜ ]
```

### **ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤º**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”  åŒ¿åå¤ªéƒ  ğŸ”„              â”‚
â”‚  â”‚ç”»åƒâ”‚  user@example.com    âš™ï¸    â”‚
â”‚  â””â”€â”€â”€â”€â”˜  ã“ã‚“ã«ã¡ã¯!ç¤¾ä¼šäºº3å¹´ç›®ã§ã™ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ 5 â”‚ â¤ï¸ 12 â”‚ ğŸ’¬ 8 â”‚           â”‚
â”‚  â”‚æŠ•ç¨¿â”‚ã„ã„ã­ â”‚ã‚³ãƒ¡ãƒ³ãƒˆâ”‚           â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & RLS ãƒãƒªã‚·ãƒ¼**

### **profiles ãƒ†ãƒ¼ãƒ–ãƒ« RLS**

| ãƒãƒªã‚·ãƒ¼å | ã‚¿ã‚¤ãƒ— | æ¨©é™ | æ¡ä»¶ |
|----------|------|------|------|
| `Profiles are viewable by everyone` | SELECT | å…¨å“¡ | èª°ã§ã‚‚é–²è¦§å¯èƒ½ |
| `Users can insert own profile` | INSERT | èªè¨¼æ¸ˆã¿ | `auth.uid() = id` |
| `Users can update own profile` | UPDATE | èªè¨¼æ¸ˆã¿ | `auth.uid() = id` |

### **Storage RLS (avatars ãƒã‚±ãƒƒãƒˆ)**

| ãƒãƒªã‚·ãƒ¼å | ã‚¿ã‚¤ãƒ— | æ¨©é™ | æ¡ä»¶ |
|----------|------|------|------|
| `Avatar images are publicly accessible` | SELECT | å…¨å“¡ | `bucket_id = 'avatars'` |
| `Authenticated users can upload avatars` | INSERT | èªè¨¼æ¸ˆã¿ | è‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ |
| `Users can update own avatars` | UPDATE | èªè¨¼æ¸ˆã¿ | è‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ |
| `Users can delete own avatars` | DELETE | èªè¨¼æ¸ˆã¿ | è‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ |

---

## âœ… **ãƒ†ã‚¹ãƒˆæ‰‹é †**

### **1. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
1. è¨­å®š â†’ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
2. ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. JPG/PNG/WEBP ç”»åƒã‚’é¸æŠ (2MBä»¥ä¸‹)
4. âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºç¢ºèª
5. ä¿å­˜ã‚’ã‚¯ãƒªãƒƒã‚¯
6. âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸ã«åæ˜ ç¢ºèª

### **2. è‡ªå·±ç´¹ä»‹å…¥åŠ›**
1. è¨­å®š â†’ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
2. è‡ªå·±ç´¹ä»‹æ¬„ã«å…¥åŠ› (200æ–‡å­—ä»¥å†…)
3. âœ… æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç¢ºèª
4. ä¿å­˜ã‚’ã‚¯ãƒªãƒƒã‚¯
5. âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸ã§2è¡Œè¡¨ç¤ºç¢ºèª

### **3. ç”»åƒå‰Šé™¤**
1. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ã§ç”»åƒã‚’é¸æŠ
2. X ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤ç¢ºèª
4. ä¿å­˜ã‚’ã‚¯ãƒªãƒƒã‚¯
5. âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º

### **4. ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ**
1. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…é**: 2MBä»¥ä¸Šã®ç”»åƒã‚’é¸æŠ
   - âœ… "ç”»åƒã‚µã‚¤ã‚ºã¯2MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„" ã‚¨ãƒ©ãƒ¼

2. **éå¯¾å¿œå½¢å¼**: GIF, BMP ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
   - âœ… "JPGã€PNGã€WEBPå½¢å¼ã®ç”»åƒã®ã¿" ã‚¨ãƒ©ãƒ¼

---

## ğŸ› **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

### **å•é¡Œ1: "avatars ãƒã‚±ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"**

**åŸå› **: Storage ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

**è§£æ±º**:
1. Supabase Dashboard â†’ Storage
2. **"Create bucket"** ã‚¯ãƒªãƒƒã‚¯
3. Bucket name: `avatars`
4. **Public bucket ãƒã‚§ãƒƒã‚¯** âœ…

---

### **å•é¡Œ2: "avatar_url ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ã¾ã›ã‚“"**

**åŸå› **: `profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ›´æ–°ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

**è§£æ±º**:
```sql
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS avatar_url TEXT;
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS bio TEXT;
```

---

### **å•é¡Œ3: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•— (403 Forbidden)**

**åŸå› **: RLS ãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

**è§£æ±º**:
- `supabase_profiles.sql` ã® Storage RLS ãƒãƒªã‚·ãƒ¼éƒ¨åˆ†ã‚’ SQL Editor ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

---

### **å•é¡Œ4: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„**

**åŸå› **: Public bucket ãŒç„¡åŠ¹ã€ã¾ãŸã¯ URL ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚

**è§£æ±º**:
1. Storage â†’ `avatars` ãƒã‚±ãƒƒãƒˆ â†’ Settings
2. **"Public bucket"** ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã‹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« â†’ Network ã‚¿ãƒ–ã§ç”»åƒ URL ã‚’ç¢ºèª
4. URL ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ç›´æ¥è²¼ã‚Šä»˜ã‘ã¦ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª

---

## ğŸ’¡ **ä½œå‹•æ–¹å¼**

### **1æ®µéš: ç”»åƒé¸æŠ**
```typescript
const handleImageSelect = async (file: File) => {
  // 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const validation = validateAvatarFile(file);
  
  // 2. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ
  const previewUrl = await getAvatarPreviewUrl(file);
  
  // 3. çŠ¶æ…‹æ›´æ–°
  setSelectedImage(file);
  setImagePreview(previewUrl);
};
```

### **2æ®µéš: ä¿å­˜æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
```typescript
const handleSave = async () => {
  // 1. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  if (selectedImage) {
    const result = await uploadAvatar(selectedImage, userId);
    avatarUrl = result.url;
  }
  
  // 2. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
  await updateProfile({
    nickname,
    bio,
    avatar_url: avatarUrl,
  });
  
  // 3. ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  router.push("/mypage");
};
```

### **3æ®µéš: ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤º**
```typescript
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
const { profile } = useProfile(user?.id);

// ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º
{profile?.avatar_url ? (
  <img src={profile.avatar_url} alt="Avatar" />
) : (
  <DefaultAvatar />
)}

// è‡ªå·±ç´¹ä»‹è¡¨ç¤º
{profile?.bio && <p>{profile.bio}</p>}
```

---

## ğŸ“Š **ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ **

```
avatars/
  â””â”€ {user-id}/
       â””â”€ avatar.{ext}
```

**ä¾‹:**
```
avatars/
  â””â”€ abc123-def456-ghi789/
       â””â”€ avatar.jpg
```

---

## ğŸ‰ **å®Œäº†!**

ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã¨è‡ªå·±ç´¹ä»‹æ©Ÿèƒ½ãŒæ­£å¸¸ã«å®Ÿè£…ã•ã‚Œã¾ã—ãŸ!

**æ¬¡ã®æ‰‹é †ã‚’é–‹å§‹ã—ã¦ãã ã•ã„:**
1. âœ… `supabase_profiles.sql` å®Ÿè¡Œ
2. âœ… `avatars` ãƒã‚±ãƒƒãƒˆä½œæˆ (Public)
3. âœ… ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
4. âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ã§ãƒ†ã‚¹ãƒˆ

**å•é¡ŒãŒã‚ã‚Œã°ä¸Šè¨˜ã®ã€Œãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„!** ğŸ“¸âœ¨
